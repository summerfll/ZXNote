# 【计算机网络】IPv6

## IPv6地址

### IPv6地址类型：

地址分为单播、多播和任意播。

单播：传统的点对点通信。

多播：一对多通信。

任播：任播的终点是一组计算机，但数据报之交付其中的一个，通常是距离最近的一个。

![4](F:\学习专用\学习笔记\图片\4.png)

### 区域索引

区域索引唯一地标明了单节点内地一个特定地区域。它仅对节点有意义，其表示方法可以实现特有地。一个节点地每个接口都属于某种范围类型地特定区域，并拥有一个相应地区域ID。RFC4007定义了一种对IPV6地址地基本文本表现形式地扩展，如下：

<address>%<zone_id>其中address为ipv6地址，zone_id用来标识地址区域字符串，%是用来区分address和zone_id地分隔符。![5](F:\学习专用\学习笔记\图片\5.png)

## IPv4向IPv6过渡

### 1.双协议栈

在完全过渡到IPv6前，是一部分主机（或路由器）装有两个协议栈，一个IPv4和一个IPv6。双协议主机（或路由器）记为IPv6/IPv4有两种IP地址：一个IPv4和一个IPv6地址，既能和IPv6的系统通信也能和IPv6的系统通信。![6](F:\学习专用\学习笔记\图片\6.png)

### 2.隧道技术

IPv6数据报要进入IPv4网络时，将IPv6数据报封装成IPv4数据报（整个IPv6数据报变成IPv4数据报的数据部分）,然后IPv6数据报就在IPv4网络的隧道中传输。当IPv4数据报离开IPv4网络中的随到时再把数据部分（原IPv6数据报）交给IPv6协议栈。

![7](F:\学习专用\学习笔记\图片\7.png)

## ICMPv6协议

### ICMPv6报文类型和格式

RFC2463定义了4种差错报文和2种信息报文，在分组处理过程中遇到问题时，就可以向源端体检错误报文，而信息报文则提供一些诊断功能。

4中差错报文：

- 目的不可达（Destination Unreachable）
- 分组太长（packet too big）
- 超时（Time Exceeded）
- 参数问题（Parameter Problem）

2种信息报文：

- 回送请求（Echo Request）
- 回送应答（Echo Reply）

### 差错报文

#### 1.目的不可达报文

目的不可达报文可以由分组源节点、通往分组目的路径上的中间节点或最终目的节点产生，以响应由于各种原因无法传达的分组。

![8](F:\学习专用\学习笔记\图片\8.png)

类型：长度1字节，标识ICMPv6报文类型，对于目的不可达报文，此字段为1

代码：长度1字节，标识正在传达的不可达差错的子类型。

![9](F:\学习专用\学习笔记\图片\9.png)

检验和：长度2字节，用于ICMP首部的16比特检验和字段

未用：长度4字节诶，未使用

分组承载：在ICMPv6差错报文长度不超过IPv6最大传输单元（MTU）的最小值1280字节的条件下，将IPv6数据报尽可能多的填充进来

**例程：**

![10](F:\学习专用\学习笔记\图片\10.png)

#### 2.分组太长报文

当中间节点由于输出链路的MTU小于分组长度而无法转发分组时，机会生成分组太长报文。![11](F:\学习专用\学习笔记\图片\11.png)

类型：长度1字节诶，字段值为2

代码：长度1字节，字段值为0

MTU：长度4字节诶，字段存储了下一条链路的MTU值

分组承载：与目的不可达报文一样

#### 3.超时报文

由于路由选择机制在互联网上的工作特性，总是存在数据报在系统中迷路，花上许多时间从一台路由器差U年底到另一台路由器的危险。为此IPv4数据报包含了一个称为寿命（TTL）的字段，打算由发送数据报的设备在此字段中设置一个时间值，并且将字段作为一个定时器来使用，若数据花了很长时间未到达目的地就将该数据报丢弃。

而IPv6中不再以秒为时间单位，而是允许数据报经过的跳数，路由器每传送一个IPv6数据报，就会将其跳数限制字段减1，如果减为0，表明数据报过期并丢弃。此时，丢弃数据报的路由器将向数据报的初始发送方发送一个ICMPv6时间超限报文通知它数据报被丢弃。![12](F:\学习专用\学习笔记\图片\12.png)

**类型：**长度为1字节，值为3

**代码：**长度为1字节![13](F:\学习专用\学习笔记\图片\13.png)

**校验和：**长度2字节，用于ICMP首部的16比特检验和字段

**未用：**长度4字节，未使用

**分组承载：**同上

#### 4.参数问题报文

参数问题报文表明设备在设法处理一个IPv6数据报中的首部时发现某个参数存在问题，只有当遇到的差错足够严重，设备无法理解数据报不得不将其丢弃时才产生这种报文。![14](F:\学习专用\学习笔记\图片\14.png)

类型：长度1字节，值为4

代码：长度1字节![15](F:\学习专用\学习笔记\图片\15.png)

**指针：**原始分组中遇到错误的位置的字节偏移量，这个错误触发了ICMPv6错误报文

**分组承载：**同上

### 信息报文

#### 1.回显请求报文

节点生成回显请求报文主要是为了进行诊断，如确定一个感兴趣节占的可达性及往返时延，报文格式如下

![16](F:\学习专用\学习笔记\图片\16.png)

**类型：**长度1，值128、

**代码：**长度1，未用设置为0

**检验和：**长度2，用于ICMP首部的16比特检验和字段

**标识符：**长度2，哟公寓辅助回显请求和回显应答报文配置对的可选的标识字段

**序列号：**长度2，辅助回显请求和回显应答报文配对的一个序列号

**数据：**可变，随同报文一起发送的附加可选数据

**例程：**

![17](F:\学习专用\学习笔记\图片\17.png)

#### 2.回显应答报文

每个IPv6实现收到一条回送报文时都必须响应，并产生一条回送应答报文

![18](F:\学习专用\学习笔记\图片\18.png)

**类型**：长度1，值129

**代码：**长度1，未用设置为0

**检验和：**长度2，用于ICMP首部的16比特检验和字段

**标识符：**长度2，用于辅助回显请求和回显应答报文配置对的可选的标识字段，是从回显请求报文中获得

**序列号：**长度2，辅助回显请求和回显应答报文配对的一个序列号，从回显请求报文中获得

**数据：**可变，随同报文一起发送的附加可选数据

![19](F:\学习专用\学习笔记\图片\19.png)